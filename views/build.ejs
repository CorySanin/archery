<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en">

<head>
    <%- include("head", locals) %>
</head>

<body class="preload">
    <%- include("navigation", locals) %>
    <div class="content">
        <h1>Build #<%= build.id %></h1>
        <h2 id="buildStatus"><%= build.status %></h2>
        <% if (!public) { %>
        <h3 id="sqid" class="display-none"><%= build.sqid %></h3>
        <% } %>
        <div class="overflow-x">
            <div class="grid-2col">
                <label>Repo</label> <span><span><%= build.repo %></span> <button class="copybtn">Copy</button></span>
                <label>Commit</label> <span><% if (build.commit) { %><%= build.commit %><% } else { %>latest<% } %></span>
                <label>Patch</label> <span><% if (build.patch) { %><a href="/build/<%= build.sqid %>/patch">patch file</a><% } else { %>none<% } %></span>
                <label>Distro</label> <span><%= build.distro %></span>
                <label>Dependencies</label> <span><%= build.dependencies %></span>
                <label>Start time</label> <span class="to-local-time"><%= build.startTime %></span>
                <% if (build.userId && build.userId !== '-1') { %>
                <label>Triggered by</label> <span><%= build.user.displayName %> (<%= build.user.username %>)</span>
                <% } %>
                <% if (!public) { %>
                <label>Persist</label> <span><input id="persistChk" type="checkbox" <% if (build.persist) { %>checked<% } %>/></span>
                <% } %>
                <% if (locals.shareable) { %>
                <label>Shareable link</label> <span><a href="<%= shareable %>"><%= shareable %></a> <button class="copybtn">Copy</button></span>
                <% } %>
            </div>
        </div>
        <% if (build.sqid && !public) { %>
        <div>
            <a href="/build?id=<%= build.sqid %>" class="button">Clone</a>
        </div>
        <% } %>
        <% if (!ended && !public) { %>
        <div id="cancelRow">
            <a href="cancel" class="button">Cancel build</a>
        </div>
        <% } %>
        <p><a href="logs">Full logs</a></p>
        <pre class="overflow-x"><div class="logs" id="logs"><% (log || []).forEach(line => { %><p><%= line %></p><% }) %></div></pre>

        <% if (!ended) { %>
        <label id="followCheckmarkContainer" title="Follow logs">
            <input type="checkbox" id="followCheckmark" />
        </label>
        <% } %>
    </div>
    <%- include("footer", locals) %>
    <script src="/assets/js/timezone.js?v1" nonce="<%= cspNonce %>"></script>
    <script src="/assets/js/form.js?v1" nonce="<%= cspNonce %>"></script>
    <% if (!ended) { %>
    <script src="/assets/js/build.js?v3" nonce="<%= cspNonce %>"></script>
    <% } %>
</body>
</html>
